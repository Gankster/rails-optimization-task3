# Case-study оптимизации

## Актуальная проблема
В нашем проекте возникли две серьёзные проблемы.

Я решил исправить эти проблемы, оптимизировав их.

- Нужно оптимизировать механизм перезагрузки расписания из файла.
- Нужно найти и устранить проблемы, замедляющие формирование этих страниц.

## Проблема 1: Импорт данных

### Формирование метрики
Для того, чтобы понимать, дают ли мои изменения положительный эффект на быстродействие программы я придумал использовать такую метрику: *время полной обработки файла в секундах*

### Feedback-Loop
Для того, чтобы иметь возможность быстро проверять гипотезы я выстроил эффективный `feedback-loop`, который позволил мне получать обратную связь по эффективности сделанных изменений за *74 секунды*

Вот как я построил `feedback_loop`:
  1. Для проверки правильности отчета использовал минимальный набор данных `medium.json` (10K трипов).
  2. Использовал профилировщик или `pghero` для поиска точки роста
  3. Рефакторил код
  4. Повторно проверял результат
  5. В случае успешного результата делал коммит

Вот какие проблемы удалось найти и решить

#### Находка №1
- `pghero` - предложил создать несколько индексов.
- добавил индексы для `buses` и `trips`
- улучшилось на 5 сек, с 74 сек. => 69 сек.

#### Находка №2
- Решил переписать с использованием `activerecord-import`
- улучшилось очень круто, с 69 сек. => 7 сек.

### Результаты
В результате проделанной оптимизации наконец удалось обработать файл `large.json` (100K трипов) за *59 сек.* и уложиться в заданный бюджет.
Удалось улучшить метрику системы с *74 сек. до 7 сек* для `medium.json`.


